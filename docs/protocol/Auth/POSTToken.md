# POST Token

## 功能

用于 POST 请求的认证和鉴权

## 生成规则

使用 Ed25519 算法对特定内容进行签名

## Token 结构

- 4 字节 HEADER (固定值 "POST")
- 4 字节 时间戳 epoch (Unix 时间戳)
- 4 字节 nonce (随机数，防重放攻击)
- 32 字节 Public Key (用户公钥)
- 48 字节 Body SHA-384 哈希
- 64 字节 Ed25519 签名

## 生成步骤

1. 生成随机 nonce (4 字节)
2. 计算请求 Body 的 SHA-384 哈希值 (48 字节)
3. 构造明文内容：`HEADER + Timestamp + Nonce + PublicKey + BodyHash` (共 92 字节)
4. 使用用户私钥对明文内容进行 Ed25519 签名，得到 64 字节签名
5. 组合完整内容：`明文内容 + 签名` (共 156 字节)
6. 对 156 字节内容进行 Base64 编码，得到最终 Token

## 验证步骤

### 第一阶段：Authorization Header 验证
1. Base64 解码 Token 得到 156 字节内容
2. 提取前 92 字节作为明文内容
3. 提取后 64 字节作为签名
4. 使用用户公钥验证签名
5. 检查时间戳是否在 ±5 分钟内有效
6. 检查 nonce 是否在服务端缓存中（防重放攻击）

### 第二阶段：Body 内容验证
7. 计算当前请求 Body 的 SHA-384 哈希值
8. 验证明文内容中的 BodyHash 是否匹配

## 使用场景

- HTTP POST 请求的身份验证
- 请求内容的完整性验证
- 防止请求篡改和重放攻击

## 安全特性

- **双重验证** - Header 验证 + Body 验证，确保安全性
- **内容绑定** - Token 与特定请求内容绑定，防止滥用
- **完整性保护** - SHA-384 哈希确保请求内容未被修改
- **防重放攻击** - nonce + 时间戳双重保护
- **时间窗口限制** - ±5 分钟有效期控制
